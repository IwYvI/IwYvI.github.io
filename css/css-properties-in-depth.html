<!DOCTYPE html>
<html lang="zh-cn">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="baidu-site-verification" content="KO6S3jtigf" />
  <meta name="msvalidate.01" content="5A1914BC5D77DA524D02E446C53E0B5A" />
  <meta name="renderer" content="webkit|ie-comp|ie-stand">
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="format-detection" content="telephone=no"/>
  <meta name="apple-mobile-app-status-bar-style" content="black" />
  <meta name="apple-touch-fullscreen" content="YES" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0,  minimum-scale=1.0, maximum-scale=1.0" />
  <meta name="msapplication-tap-highlight" content="no">

  <title>【译】深入了解CSS自定义属性 | IwYvI</title>
  <meta name="author" content="IwYvI">
  <meta name="description" content="【翻译】《CSS custom properties (native variables) In-Depth》：CSS自定义属性是一项新的CSS特性，它是一种在CSS中定义的变量，我们可以用这些变量实现一些新的功能，同时CSS自定义属性也提供了CSS与JS交互的新方式，与其他CSS预处理器也能做到完美配合。">
  <meta name="keywords" content="css,iwyvi,IwYvI,iwyvi的博客,IwYvI的博客,前端">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://www.iwyvi.com/css/css-properties-in-depth">
  <link rel="alternate" type="application/rss+xml" title="IwYvI" href="http://www.iwyvi.com/feed.xml">
</head>


  <body>

    <div class="background">
  <div class="ribbon"></div>
  <div class="tableCard"></div>
</div>
<div class="nav">
  <table>
    <tr>
      <td><a href="/" rel="nofollow">首页</a></td>
      <td><a href="/archives/" rel="bookmark">文章</a></td>
      <td><a href="/works/" rel="bookmark">作品</a></td>
      <td><a href="/about/" rel="bookmark">关于</a></td>
    </tr>
    <tr>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </table>
</div>
<div class="container">
  <div class="header">
    <div class="headerBackground">
      <div class="headerBackgroundImg"></div>
    </div>
    <div class="headerContent">
      <div class="avatar" alt="avatar">
        <a href="/">
          <img src="http://7xsaq2.com1.z0.glb.clouddn.com/img%2Favatar.jpg" alt="avatar">
        </a>
      </div>
      <div class="blogTitle">
        <h1>IwYvI</h1>
        <p>干了这碗鸡汤</p>
      </div>
    </div>
  </div>
  <div class="main">
    <div class="mainBackground">
      <div class="mainBackgroundLeft"></div>
      <div class="mainBackgroundRight">
        <div class="mainBackgroundCode">
<!-- 这段代码是从电影《极乐空间》空站重新启动的代码，原文在《Intel Architecture Software Developer’s Manual Volume 3: System Programming》8-24页 -->
          <pre>; fixup GDT base in descriptor
 MOV ECX,EDX
 MOV [EDX].bas_0_15+GDT_DESC_OFF,CX
 ROR ECX,16
 MOV [EDX].bas_16_23+GDT_DESC_OFF,CL
 MOV [EDX].bas_24_31+GDT_DESC_OFF,CH

 ; copy EPROM IDT to ram at:
 ; RAM_START+size(STARTUP_DATA)+SIZE (EPROM GDT)
 MOV ECX, CS_BASE
 ADD ECX, OFFSET (IDT_EPROM)
 MOV ESI, [ECX].table_linear
 MOV EDI,EAX
 MOVZX ECX, [ECX].table_lim
 MOV APP_IDT_ram[EBX].table_lim,CX
 INC ECX
 MOV APP_IDT_ram[EBX].table_linear,EAX
 MOV EBX,EAX
 ADD EAX,ECX
 REP MOVS BYTE PTR ES:[EDI],BYTE PTR DS:[ESI]</pre>
        </div>
      </div>
    </div>


    <div class="mainContent">
        <div class="article largeCard">
	<div class="articleContent largeCardContent">
	    <h2>【译】深入了解CSS自定义属性</h2>
	    
	    	<p class="date"><time datetime="2016-04-20T00:00:00+08:00" itemprop="datePublished">Apr 20, 2016</time></p>
	    
	    
	    	<p class="categories">css</p>
	    
	    <div class="articleDetail largeCardDetail">
	    	<div class="markdown">
	<div class="description">【翻译】《CSS custom properties (native variables) In-Depth》：CSS自定义属性是一项新的CSS特性，它是一种在CSS中定义的变量，我们可以用这些变量实现一些新的功能，同时CSS自定义属性也提供了CSS与JS交互的新方式，与其他CSS预处理器也能做到完美配合。</div>

<blockquote>
  <p>原文链接：<a href="https://blog.gospodarets.com/css_properties_in_depth">CSS custom properties (native variables) In-Depth</a></p>

  <p>原文发布时间：March 29, 2016</p>

  <p>原作者：Serg Gospodarets</p>

  <p>翻译者：IwYvI</p>
</blockquote>

<blockquote>
  <p>这将是我翻译的第一篇文章，主要是关于CSS自定义属性等内容。（这篇文章看上去翻译起来比较简单，（不知道我翻译完了还会不会这么说</p>
</blockquote>

<blockquote>
  <p>词汇翻译：</p>

  <ul>
    <li>CSS property：CSS属性</li>
    <li>CSS custom property：CSS自定义属性</li>
    <li>CSS variable：CSS变量</li>
  </ul>

  <p>翻译这篇文章借助了有道、bing、Google的翻译。如果出现不准确的地方希望能向我提出来</p>
</blockquote>

<p>在这篇文章中，我本想从解释CSS变量的用途开始说起，但是事实上许多流行的CSS预、后处理器已经实现了这个功能</p>

<p>几个用途的例子：</p>

<ul>
  <li>颜色变量</li>
  <li>组件的常量属性（布局，位置属性等等）</li>
  <li>避免代码冗余</li>
</ul>

<p>当然，你仍然可以手动在你的代码库里查找或者替换你所想修改的部分，但是这就像在JS中没有定义变量直接使用硬编码的值一样痛苦。动态的和限定作用域的CSS变量将对你的实验和应用程序提供更多功能：你可以自由地阅读，设置和更新它们！同时你可以避免在代码库中造成代码冗余，你可以看看最近的这篇文章<a href="https://webkit.org/blog/5989/css-variables-in-webkit/">Webkit guys did in their Web Inspector</a>。</p>

<p>同时你终于有了一个可以轻松地从CSS向JS传递数据的接口（例如媒体断点的值(media breakpoint values)）</p>

<p>下面是CSS属性具有的几个特点：</p>

<ul>
  <li>它们是动态的，能在运行时被修改</li>
  <li>它们可以轻松地用JS读写</li>
  <li>它们是可继承的，层叠的且有作用域</li>
</ul>

<p>下面，让我们深入了解什么是CSS属性和怎么使用它们</p>

<h3 id="section">名称</h3>

<p>最开始，这项特性被叫做CSS变量，但是后来被扩展和重构为CSS自定义属性</p>

<p>然而，根据它所使用的语法，更准确的名称应该是CSS属性。这篇相关文章<a href="http://tabatkins.github.io/specs/css-apply-rule/">CSS @apply rule</a>让我们觉得有点”mixins”的感觉。</p>

<p>所以目前的名称是<a href="https://drafts.csswg.org/css-variables/">CSS Custom Properties for Cascading Variables</a>（CSS层叠变量的自定义属性）。</p>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_variables#What_are_CSS_Variables">CSS变量目前有两种形式</a>:</p>

<blockquote>
  <p>变量是指一个标识符指代一个任意常规的值。<code class="highlighter-rouge">var()</code>符号：<code class="highlighter-rouge">var(--example-variable)</code>将返回<code class="highlighter-rouge">--example-variable</code>的值。</p>
</blockquote>

<blockquote>
  <p>自定义属性是指用<code class="highlighter-rouge">--*</code>这样的形式表示的属性，其中<code class="highlighter-rouge">*</code>代表变量名称。用这种形式给变量赋值：<code class="highlighter-rouge">--example-variable: 20px;</code>，这句话表示将变量<code class="highlighter-rouge">--example-variable</code>赋值为<code class="highlighter-rouge">20px</code>。</p>
</blockquote>

<h3 id="css">第一个CSS变量</h3>

<p>或许这会让你惊讶，因为你有可能已经了解并且使用过一个CSS变量（看起来是第一个）<code class="highlighter-rouge">currentColor</code>，这个变量虽然并不是众所周知的但是<a href="https://css-tricks.com/currentcolor/">仍然可以使用</a>并且<a href="http://caniuse.com/#feat=currentcolor">可以在所有浏览器中工作</a>。</p>

<p>它同样有作用域并且可以被重新定义：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nd">:root</span> <span class="p">{</span> <span class="nl">color</span><span class="p">:</span> <span class="no">red</span><span class="p">;</span> <span class="p">}</span>
<span class="nt">div</span> <span class="p">{</span> <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="n">currentColor</span><span class="p">;</span> <span class="p">}</span> <span class="c">/* border-color is red */</span>
</code></pre>
</div>

<p>如果你加上这一句</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">div</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="no">black</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>边框的颜色<a href="http://codepen.io/malyw/pen/yObLEX">将变回黑色</a></p>

<h3 id="css-1">CSS变量的语法</h3>

<h4 id="section-1">赋值</h4>

<p>你可以使用<code class="highlighter-rouge">--variable-name: variable-value;</code>这个语法来定义一个变量（变量名是大小写敏感的）。而变量的值可以是颜色，字符串等等：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nd">:root</span><span class="p">{</span>
  <span class="py">--main-color</span><span class="p">:</span> <span class="m">#4d4e53</span><span class="p">;</span>
  <span class="py">--main-bg</span><span class="p">:</span> <span class="nb">rgb</span><span class="p">(</span><span class="m">255</span><span class="p">,</span> <span class="m">255</span><span class="p">,</span> <span class="m">255</span><span class="p">);</span>
  <span class="py">--logo-border-color</span><span class="p">:</span> <span class="n">rebeccapurple</span><span class="p">;</span>
  <span class="py">--header-height</span><span class="p">:</span> <span class="m">68px</span><span class="p">;</span>
  <span class="py">--content-padding</span><span class="p">:</span> <span class="m">10px</span> <span class="m">20px</span><span class="p">;</span>
  <span class="py">--base-line-height</span><span class="p">:</span> <span class="m">1.428571429</span><span class="p">;</span>
  <span class="py">--transition-duration</span><span class="p">:</span> <span class="m">.35s</span><span class="p">;</span>
  <span class="py">--external-link</span><span class="p">:</span> <span class="s1">"external link"</span><span class="p">;</span>
  <span class="py">--margin-top</span><span class="p">:</span> <span class="n">calc</span><span class="p">(</span><span class="m">2vh</span> <span class="err">+</span> <span class="m">20px</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>语法似乎看起来很吃藕，但是这是因为<a href="http://www.xanthir.com/blog/b4KT0">种种原因</a>。例如<code class="highlighter-rouge">$var</code>这样的变量语法就会被其他的CSS预处理器处理。</p>

<h4 id="section-2">用法</h4>

<p>你可以在CSS像这样用变量：<code class="highlighter-rouge">some-css-value: var(--variable-name [, declaration-value]);</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">p</span> <span class="p">{</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--p-margin</span><span class="p">,</span> <span class="m">0</span> <span class="m">0</span> <span class="m">10px</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>在上面这个例子中如果<code class="highlighter-rouge">--p-margin</code>没有被定义，<code class="highlighter-rouge">0 0 10px</code>将被使用。这样的特性会让编写的代码更灵活，例如你可以使用一些来自框架的变量（通常多数变量已经被定义了），但是当你要移除它们的时候这个特性将会节约做其他【高端】的事的时间。</p>

<h4 id="section-3">作用域</h4>

<p>正如<a href="https://drafts.csswg.org/css-variables/">module’s documentation title</a>里提到的，自定义属性也遵守<a href="https://drafts.csswg.org/css-cascade-4/#cascade">CSS层叠规则</a>。</p>

<p>用<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/:root"><code class="highlighter-rouge">:root scope</code></a>来创建一个全局变量：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nd">:root</span><span class="p">{</span>
  <span class="py">--global-var</span><span class="p">:</span> <span class="s2">'global'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>如果你想创建一个只在某个元素或组件里存在的变量，就在那个元素里面[重]定义这个变量（<a href="http://codepen.io/malyw/pen/QNvwRV">demo</a>）：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"block"</span><span class="nt">&gt;</span>
  My block is
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"block__highlight"</span><span class="nt">&gt;</span>awesome<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code><span class="nc">.block</span> <span class="p">{</span>
  <span class="py">--block-font-size</span><span class="p">:</span> <span class="m">1rem</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--block-font-size</span><span class="p">);</span>
<span class="p">}</span>

<span class="nc">.block__highlight</span> <span class="p">{</span>
  <span class="py">--block-highlight-font-size</span><span class="p">:</span> <span class="m">1.5rem</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--block-highlight-font-size</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>媒体查询同样提供了作用域（<a href="http://codepen.io/malyw/pen/grgJJJ">demo</a>）：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">@media</span> <span class="n">screen</span> <span class="n">and</span> <span class="p">(</span><span class="n">min-width</span><span class="p">:</span> <span class="m">1025px</span><span class="p">)</span> <span class="p">{</span>
  <span class="nd">:root</span> <span class="p">{</span>
    <span class="py">--screen-category</span><span class="p">:</span> <span class="s2">'desktop'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>下一个关于作用域的例子是<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Pseudo-classes">伪类</a>（例如：<code class="highlighter-rouge">:hover</code>）（<a href="http://codepen.io/malyw/pen/ZWygyv">demo</a>）：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">body</span> <span class="p">{</span>
  <span class="py">--bg</span><span class="p">:</span> <span class="m">#f00</span><span class="p">;</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--bg</span><span class="p">);</span>
  <span class="nl">transition</span><span class="p">:</span> <span class="n">background-color</span> <span class="m">1s</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">body</span><span class="nd">:hover</span> <span class="p">{</span>
  <span class="py">--bg</span><span class="p">:</span> <span class="m">#ff0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>当定义了全局的自定义变量，为了避免命名冲突，可以看看这篇文章<a href="http://codepen.io/malyw/pen/eZgaQv">a common convention naming your variables</a>（或者更简单地用<a href="http://getbem.com/naming/">BEM naming convention</a>这个方法来命名），例如：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nd">:root</span> <span class="p">{</span>
  <span class="c">/* main (page-wide) variables */</span>
  <span class="py">--main-color</span><span class="p">:</span> <span class="m">#555</span><span class="p">;</span>
  <span class="py">--main-bg</span><span class="p">:</span> <span class="nb">rgb</span><span class="p">(</span><span class="m">200</span><span class="p">,</span> <span class="m">200</span><span class="p">,</span> <span class="m">200</span><span class="p">);</span>
  <span class="c">/* accordion variables */</span>
  <span class="py">--accordion-bg</span><span class="p">:</span> <span class="m">#f00</span><span class="p">;</span>
  <span class="py">--accordion-font-size</span><span class="p">:</span> <span class="m">1.5rem</span><span class="p">;</span>
  <span class="py">--accordion__item-bg</span><span class="p">:</span> <span class="m">#ded</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">body</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--main-color</span><span class="p">);</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--main-bg</span><span class="p">);</span>
  <span class="c">/*...*/</span>
<span class="p">}</span>
</code></pre>
</div>

<h4 id="section-4">用其他变量来赋值</h4>

<p>同样我们可以用其他变量来给变量赋值<code class="highlighter-rouge">--variable-name: var(--another-variable-name);</code>（<a href="http://codepen.io/malyw/pen/NNjqWB">demo</a>）：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nc">.block</span> <span class="p">{</span>
  <span class="py">--block-text</span><span class="p">:</span> <span class="s2">'This is my block'</span><span class="p">;</span>
  <span class="py">--block-highlight-text</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--block-text</span><span class="p">)</span><span class="s2">' with highlight'</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.block</span><span class="nd">:before</span> <span class="p">{</span>
  <span class="nl">content</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--block-text</span><span class="p">);</span>
<span class="p">}</span>

<span class="nc">.block__highlight</span><span class="nd">:before</span> <span class="p">{</span>
  <span class="nl">content</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--block-highlight-text</span><span class="p">);</span> <span class="c">/*This is my block with highlight*/</span>
<span class="p">}</span>
</code></pre>
</div>

<p>这里有一个小问题，就是不能简单地用已定义的变量来计算出新的变量值。但是我们可以用<a href="https://developer.mozilla.org/en/docs/Web/CSS/calc"><code class="highlighter-rouge">calc()</code></a>来代替（<a href="http://codepen.io/malyw/pen/GZmJgO">demo</a>）：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nc">.block</span> <span class="p">{</span>
  <span class="py">--block-font-size</span><span class="p">:</span> <span class="m">1rem</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.block__highlight</span> <span class="p">{</span>
  <span class="c">/* DOESN'T WORK */</span>
  <span class="py">--block-highlight-font-size</span><span class="p">:</span> <span class="n">--block-font-size</span><span class="p">)</span><span class="err">*</span><span class="m">1.5</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--block-highlight-font-size</span><span class="p">);</span>

  <span class="c">/* WORKS */</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="n">calc</span><span class="p">(</span><span class="n">var</span><span class="p">(</span><span class="n">--block-font-size</span><span class="p">)</span><span class="err">*</span><span class="m">1.5</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>注意，那些很庞大的表达式可能会影响到应用的性能</p>

<h4 id="calc">使用calc()计算</h4>

<p>上面已经提到你不能像这样使用变量：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nt">padding</span><span class="o">:</span> <span class="nt">var</span><span class="o">(</span><span class="nt">--spacer</span><span class="o">)</span><span class="nt">px</span>
</code></pre>
</div>

<p>但是可以使用<code class="highlighter-rouge">calc()</code>来进行计算。让我们做一个<a href="http://codepen.io/malyw/pen/MymmNK">vertical rhythm</a>（这个怎么翻译嘤嘤嘤）的例子：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="nt">margin</span><span class="o">:</span> <span class="nt">0</span> <span class="nt">0</span> <span class="nt">calc</span><span class="o">(</span><span class="nt">var</span><span class="o">(</span><span class="nt">--base-line-height</span><span class="o">,</span> <span class="nt">0</span><span class="o">)</span> <span class="o">*</span> <span class="nt">1rem</span><span class="o">);</span>
</code></pre>
</div>

<h4 id="section-5">重置或继承变量的值</h4>

<p>CSS自定义属性默认是继承的。这种情况下为了减小对块或组件的副作用，你可以<a href="http://codepen.io/malyw/pen/qZReZB">重置自定义属性</a>：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nc">.with-reset</span> <span class="p">{</span>
  <span class="py">--bgcolor</span><span class="p">:</span> <span class="n">initial</span><span class="p">;</span><span class="c">/* RESETS VALUE */</span>
  <span class="py">--color</span><span class="p">:</span> <span class="no">green</span><span class="p">;</span><span class="c">/* CHANGES VALUE */</span>
  <span class="py">--border</span><span class="p">:</span> <span class="nb">inherit</span><span class="p">;</span><span class="c">/* DOESN'T CHANGE ANYTHING, AS INHERITED BY DEFAULT */</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="javascript">用JavaScript控制自定义属性</h3>

<p>你可以使用JS轻松地读写自定义属性。（<a href="https://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration">CSS样式声明接口</a>(<code class="highlighter-rouge">getPropertyValue</code>,<code class="highlighter-rouge">setProperty</code>)）：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// READ</span>
<span class="kr">const</span> <span class="nx">rootStyles</span> <span class="o">=</span> <span class="nx">getComputedStyle</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">varValue</span> <span class="o">=</span> <span class="nx">rootStyles</span><span class="p">.</span><span class="nx">getPropertyValue</span><span class="p">(</span><span class="s1">'--screen-category'</span><span class="p">).</span><span class="nx">trim</span><span class="p">();</span>
<span class="c1">// WRITE</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span><span class="s1">'--screen-category'</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
</code></pre>
</div>

<p>下面是一个DEMO，使用``–screen-category`这个自定义变量代表当前显示类型，它可以在UI界面中被修改。（<a href="http://codepen.io/malyw/pen/grgJJJ">demo</a>）</p>

<p>这个demo中展示了JS中对自定义变量进行debug的方法：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// GET</span>
<span class="nx">alert</span><span class="p">(</span>
    <span class="nx">getComputedStyle</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">).</span><span class="nx">getPropertyValue</span><span class="p">(</span><span class="s1">'--screen-category'</span><span class="p">).</span><span class="nx">trim</span><span class="p">();</span>
<span class="p">);</span>

<span class="c1">// SET</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span><span class="s1">'--screen-category'</span><span class="p">,</span> <span class="s1">'custom'</span><span class="p">);</span>

<span class="c1">// or reassign from an another prop</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span>
    <span class="s1">'--screen-category'</span><span class="p">,</span> <span class="s1">'var(--default-screen-category, '</span><span class="o">%</span><span class="nx">DEFAULT</span> <span class="nx">VALUE</span> <span class="nx">IF</span> <span class="nx">VAR</span> <span class="nx">IS</span> <span class="nx">NOT</span> <span class="nx">SET</span><span class="o">%</span><span class="s1">')'</span>
<span class="p">);</span>
</code></pre>
</div>

<p>现在我们能把任意值赋给CSS变量，也有了接口在JS读写这些变量，这样我们就可以摆脱以前使用的<a href="https://blog.gospodarets.com/passing_data_from_sass_to_js">从CSS/SASS中向JS传递数据</a>这样的方法。（例如：<a href="http://codepen.io/malyw/pen/zGxodr">list of media queries breakpoints</a>）。</p>

<p>把变量放在<code class="highlighter-rouge">content</code>中，将会在页面上输出它的值，这样可以用来做debug：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">body</span><span class="nd">:after</span> <span class="p">{</span>
  <span class="nl">content</span><span class="p">:</span> <span class="s2">'--screen-category : '</span><span class="n">var</span><span class="p">(</span><span class="n">--screen-category</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="section-6">浏览器支持</h3>

<p>自定义属性已经可以在Chrome，Firefox和桌面版Safari 9.1里正常使用了：</p>

<p><img src="http://7xsaq2.com1.z0.glb.clouddn.com/img/cssvariablesbrowsersupport.jpg" alt="browser_support" /></p>

<p style="text-align:center">Stats from <a href="http://caniuse.com/#feat=css-variables">caniuse.com</a></p>

<p>这个特性在<a href="https://dev.windows.com/en-us/microsoft-edge/platform/status/cssvariables">Microsoft Edge浏览器里的支持还在考虑中</a></p>

<p>它们目前还有一些限制和bug：</p>

<ul>
  <li><a href="http://codepen.io/malyw/pen/ONmjzp">用<code class="highlighter-rouge">calc()</code>计算CSS变量</a>可能会在某些浏览器上出错</li>
  <li>人们还在讨论<a href="https://github.com/w3c/webcomponents/issues/300#issuecomment-144551648">为当前作用域中的自定义属性添加一些基础规则</a>，例如<code class="highlighter-rouge">--: initial;</code></li>
  <li>不能使用常规CSS属性名称： <del><code class="highlighter-rouge">var(--side): 10px;</code></del></li>
  <li>用<code class="highlighter-rouge">calc()</code>计算时需要这样写：<code class="highlighter-rouge">calc(var(--base-line-height, 0) * 1rem)</code></li>
  <li>不能当做媒体查询的值 <del><code class="highlighter-rouge">@media screen and (min-width: var(--desktop-breakpoint))</code></del></li>
  <li>图片的url也不可以使用变量 <del><code class="highlighter-rouge">url(var(--image-url))</code></del></li>
</ul>

<p>这里有个<a href="http://codepen.io/malyw/pen/GZmzPG">DEMO</a>可以用来测试浏览器对CSS自定义属性的支持。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">@supports</span> <span class="p">(</span> <span class="p">(</span><span class="n">--a</span><span class="p">:</span> <span class="m">0</span><span class="p">))</span> <span class="p">{</span>
  <span class="c">/* supported */</span>
<span class="p">}</span>

<span class="k">@supports</span> <span class="p">(</span> <span class="n">not</span> <span class="p">(</span><span class="n">--a</span><span class="p">:</span> <span class="m">0</span><span class="p">))</span> <span class="p">{</span>
  <span class="c">/* not supported */</span>
<span class="p">}</span>
</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">CSS</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">CSS</span><span class="p">.</span><span class="nx">supports</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">CSS</span><span class="p">.</span><span class="nx">supports</span><span class="p">(</span><span class="s1">'--a'</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
  <span class="nx">alert</span><span class="p">(</span><span class="s1">'CSS properties are supported'</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">alert</span><span class="p">(</span><span class="s1">'CSS properties are NOT supported'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>对于以前的浏览器（<a href="http://caniuse.com/#feat=css-featurequeries">没有 CSS.sgpports() API</a>），你可以看看<a href="https://gist.github.com/wesbos/8b9a22adc1f60336a699">Wes Bos’ test</a>。</p>

<h3 id="fallbackspolyfills">Fallbacks/polyfills</h3>

<p>（这个标题似乎并没有什么中文词语能直接翻译，大意就是让老浏览器支持新功能）</p>

<blockquote>
  <p>接下来这两段翻译的实在是有些勉强</p>
</blockquote>

<blockquote>
  <p>There are couple examples of PostCSS plugins, but <code class="highlighter-rouge">no plugin can achieve true complete parity according to the specification because of the DOM cascade unknowns</code> + they are not dynamic.</p>

  <p>It might be solved when we see the bright future and CSS Houdini group dream of implementing <a href="https://www.smashingmagazine.com/2016/03/houdini-maybe-the-most-exciting-development-in-css-youve-never-heard-of/">an easy native way for CSS “polyfills” to all major browsers</a> will come true. And even in that case variables syntax, most of all, cannot be shimmed.</p>
</blockquote>

<p>现在已经有许多关于PostCSS插件的例子，但是这些插件都不能根据规范真正实现对等处理，因为DOM层叠结构对它们是未知的，而且这些插件所做的处理也是非动态的。</p>

<p>这个问题最终将会被解决，CSS Houdini组织提出的<a href="https://www.smashingmagazine.com/2016/03/houdini-maybe-the-most-exciting-development-in-css-youve-never-heard-of/">an easy native way for CSS “polyfills” to all major browsers</a>，应该会实现，我们也可以看得出CSS广阔的前景。最重要的是在这种情况下，变量语法不再会被忽视。</p>

<p>然而到目前为止有这样一个清单：</p>

<ul>
  <li><a href="https://github.com/postcss/postcss-custom-properties">转换W3C CSS自定义属性的PostCSS插件</a>- 一个只处理<code class="highlighter-rouge">:root</code>里声明的变量的插件</li>
  <li><a href="https://github.com/MadLittleMods/postcss-css-variables">将CSS自定义属性（CSS变量）的语法转换为静态的语句</a>，这有一个<a href="https://madlittlemods.github.io/postcss-css-variables/playground/">在线的DEMO</a>。它尝试处理了媒体查询、伪类元素和元素嵌套这些部分的作用域问题。</li>
  <li><a href="https://github.com/segmentio/myth">Myth</a>- 一个预处理器</li>
  <li><a href="https://github.com/MoOx/postcss-cssnext">CSS next</a>，为CSS添加新的语法</li>
</ul>

<h3 id="cssscss">和CSS预处理器（SCSS）一起使用</h3>

<h4 id="section-7">相同的变量名</h4>

<p>现在开始和预处理器一起使用CSS自定义属性，我们可以使用<a href="http://codepen.io/malyw/pen/grRQeq">一种混合语法来检查浏览器的支持</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">@supports</span> <span class="o">(</span> <span class="o">(</span><span class="nt">--a</span><span class="nd">:</span> <span class="nt">0</span><span class="o">))</span> <span class="p">{</span>
  <span class="cm">/* Custom properties are supported in the browser */</span>
  <span class="nd">:root</span><span class="p">{</span>
    <span class="na">--main-bg</span><span class="p">:</span> <span class="mh">#4d4e53</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nt">body</span> <span class="p">{</span>
    <span class="nl">background-color</span><span class="p">:</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">main-bg</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">@supports</span> <span class="o">(</span> <span class="nt">not</span> <span class="o">(</span><span class="nt">--a</span><span class="nd">:</span> <span class="nt">0</span><span class="o">))</span> <span class="p">{</span>
  <span class="cm">/* Custom properties are NOT supported in the browser */</span>
  <span class="nv">$main-bg</span><span class="p">:</span> <span class="mh">#4d4e53</span><span class="p">;</span>

  <span class="nt">body</span> <span class="p">{</span>
    <span class="nl">background-color</span><span class="p">:</span> <span class="nv">$main-bg</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>在这种情况下CSS和Sass的变量都存在，但是只有在浏览器不支持自定义属性时Sass变量才会被使用。</p>

<p>或者你可以把这种逻辑<a href="http://codepen.io/malyw/pen/aNwKKv">藏在Sass的mixin中</a>：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">@mixin</span> <span class="nf">setVar</span><span class="p">(</span><span class="nv">$varName</span><span class="o">,</span> <span class="nv">$value</span><span class="p">){</span>
  <span class="k">@include</span> <span class="nd">setVarSass</span><span class="p">(</span><span class="nv">$varName</span><span class="o">,</span> <span class="nv">$value</span><span class="p">);</span>
  <span class="k">@include</span> <span class="nd">setVarCss</span><span class="p">(</span><span class="nv">$varName</span><span class="o">,</span> <span class="nv">$value</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">@mixin</span> <span class="nf">setPropFromVar</span><span class="p">(</span><span class="nv">$propName</span><span class="o">,</span> <span class="nv">$varName</span><span class="p">){</span>
  <span class="k">@supports</span> <span class="o">(</span> <span class="o">(</span><span class="nt">--a</span><span class="nd">:</span> <span class="nt">0</span><span class="o">))</span> <span class="p">{</span>
    <span class="c1">// Custom properties are supported in the browser
</span>    <span class="si">#{</span><span class="nv">$propName</span><span class="si">}</span><span class="nd">:</span> <span class="nt">getVarCss</span><span class="o">(</span><span class="err">$</span><span class="nt">varName</span><span class="o">)</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">@supports</span> <span class="o">(</span> <span class="nt">not</span> <span class="o">(</span><span class="nt">--a</span><span class="nd">:</span> <span class="nt">0</span><span class="o">))</span> <span class="p">{</span>
    <span class="c1">// Custom properties are NOT supported in the browser
</span>    <span class="si">#{</span><span class="nv">$propName</span><span class="si">}</span><span class="nd">:</span> <span class="nt">getVarSass</span><span class="o">(</span><span class="err">$</span><span class="nt">varName</span><span class="o">)</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// SET
</span><span class="k">@include</span> <span class="nd">setVar</span><span class="p">(</span><span class="s1">'main-color'</span><span class="o">,</span> <span class="mh">#f00</span><span class="p">);</span>

<span class="c1">// GET
</span><span class="nt">body</span> <span class="p">{</span>
  <span class="k">@include</span> <span class="nd">setPropFromVar</span><span class="p">(</span><span class="s1">'color'</span><span class="o">,</span> <span class="s1">'main-color'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<h4 id="section-8">全局变量</h4>

<p>在Sass和CSS中变量的作用域是不同的，但是它们都可以这样做：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/* SCSS */</span>
<span class="nv">$main-color</span><span class="p">:</span> <span class="mh">#f00</span> <span class="o">!</span><span class="n">global</span><span class="p">;</span>

<span class="cm">/* CSS */</span>
<span class="nd">:root</span><span class="p">{</span>
    <span class="na">--main-color</span><span class="p">:</span> <span class="mh">#f00</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="section-9">给没有赋值的变量赋值</h3>

<p>一个常见的情况是，我们希望使用一个变量给另一个变量赋值时，如果用于赋值的变量本身没有被赋值，则需要一个默认值来赋给新的变量。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/* SCSS */</span>
<span class="nv">$main-color</span><span class="p">:</span> <span class="mh">#f00</span> <span class="o">!</span><span class="nb">default</span><span class="p">;</span>

<span class="nt">body</span><span class="p">{</span>
    <span class="nl">color</span><span class="p">:</span> <span class="nv">$main-color</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>然而你并不能在CSS里这样做：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c">/* CSS */</span>
<span class="nt">body</span><span class="p">{</span>
    <span class="py">--main-color</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--main-color</span><span class="p">,</span> <span class="m">#f00</span><span class="p">);</span> <span class="c">/* DOESN'T WORK */</span>
<span class="p">}</span>
</code></pre>
</div>

<p>但是你可以创建一个新的变量</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c">/* CSS */</span>
<span class="nt">body</span><span class="p">{</span>
    <span class="py">--local-main-color</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--main-color</span><span class="p">,</span> <span class="m">#f00</span><span class="p">);</span> <span class="c">/* DOES WORK */</span>
    <span class="nl">color</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--local-main-color</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>或者直接使用</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c">/* CSS */</span>
<span class="nt">body</span><span class="p">{</span>
    <span class="nl">color</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--main-color</span><span class="p">,</span> <span class="m">#f00</span><span class="p">);</span> <span class="c">/* DOES WORK */</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="section-10">有趣的用法</h3>

<p>自定义属性提出了这些有趣的想法：</p>

<ul>
  <li>现在可以使用原生的方法来处理CSS与JS的通信，而不是<a href="https://css-tricks.com/making-sass-talk-to-javascript-with-json/">以前用的hack方法</a></li>
  <li>另一个例子是<a href="http://codepen.io/malyw/pen/grgVGx">国际化地使用自定义属性</a>，不同语言中的text和colors可以使用<code class="highlighter-rouge">external link</code>来解决</li>
  <li>Jake Archibald 提出了一个想法：根据加载到页面的块和样式，使用CSS变量控制元素的可见性（<a href="https://jakearchibald.com/2016/css-loading-with-custom-props/">文章链接</a>）</li>
  <li>主题切换：现在不必再为特定class添加CSS样式或者增加新的CSS样式文件来改变网站主题，你可以使用自定义属性来解决这个问题。Michael Scharnagl在<a href="https://justmarkup.com/log/2016/02/theme-switcher-using-css-custom-properties/">这篇文章</a>中描述了如何处理主题切换。</li>
  <li>我还想到了一些用法，例如用于特定域名（对 domain1.site.com和domain1.site.com提供不同的外观）（原文如此）。这样我们就可以很轻松上传并应用重定义了自定义属性的CSS文件（取决于域名）</li>
</ul>

<p>最后一个想法很贴近使用自定义属性的主题切换，所以可以把他们放在一起用（<a href="https://blog.gospodarets.com/demos/css-custom-props-theme-switcher/">demo</a>）</p>

<p><a href="https://blog.gospodarets.com/demos/css-custom-props-theme-switcher/"><img src="https://i.imgur.com/DwLCfC0.gif" alt="" /></a></p>

<ul>
  <li>当然，自定义属性在<a href="http://codepen.io/malyw/pen/KzZXRq?editors=1100">补全CSS属性</a>这里看起来也很好用</li>
</ul>

<p><a href="http://codepen.io/malyw/pen/KzZXRq?editors=1100"><img src="https://i.imgur.com/E0FTuI1.jpg" alt="" /></a></p>

<h3 id="demo">Demo</h3>

<p>受到Wes Bos <a href="https://twitter.com/wesbos/status/697808716905652224">demos of interacting with CSS custom properties</a>的启发，我决定更进一步在CSS中使用<code class="highlighter-rouge">calc();</code>对颜色的R,G,B值进行计算。</p>

<p>这是灰度过滤器的代码：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nc">.grayscale</span> <span class="p">{</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="n">rgba</span><span class="p">(</span>
    <span class="n">calc</span><span class="p">(</span><span class="m">0.2126</span> <span class="err">*</span> <span class="n">var</span><span class="p">(</span><span class="n">--r</span><span class="p">)),</span>
    <span class="n">calc</span><span class="p">(</span><span class="m">0.7152</span> <span class="err">*</span> <span class="n">var</span><span class="p">(</span><span class="n">--g</span><span class="p">)),</span>
    <span class="n">calc</span><span class="p">(</span><span class="m">0.0722</span> <span class="err">*</span> <span class="n">var</span><span class="p">(</span><span class="n">--b</span><span class="p">)),</span>
    <span class="m">1</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>
<p><a href="https://blog.gospodarets.com/demos/css-colors-from-custom-props/">DEMO</a></p>

<p><a href="https://blog.gospodarets.com/demos/css-colors-from-custom-props/"><img src="https://i.imgur.com/9IUE3FR.gif" alt="" /></a></p>

<p>有趣的事实：</p>

<ul>
  <li>Chrome似乎并不喜欢<code class="highlighter-rouge">calc()</code>中的CSS变量的非整数乘除法</li>
  <li>Firefox完全不计算<code class="highlighter-rouge">rgba()</code>里面需要使用<code class="highlighter-rouge">calc()</code>计算的自定义变量</li>
  <li>Demo在Safari里能达到预期效果O(∩_∩)O~~（原本是个emoji表情）</li>
</ul>

<h3 id="section-11">结论</h3>

<p>现在你应该已经知道了CSS自定义变量的含义和如下几点：</p>

<ul>
  <li>它的语法支持CSS和JS的交互</li>
  <li>它是动态的、可继承的、层叠的和有作用域的</li>
  <li>浏览器的支持和它的fallbacks</li>
  <li>它可以和Sass变量一起使用</li>
  <li>总之，通过一些有趣的用法和示例，自定义属性确实为开发者和web平台加入了新的能力</li>
</ul>

<p>我希望读完这篇文章后你能用上自定义属性</p>

<h3 id="section-12">扩展阅读</h3>

<p>近期CSS原生mixins语法发布 - <a href="http://www.iwyvi.com/css/css-apply-rule">【译】CSS @apply规则(mixins)</a></p>

<blockquote>
  <p>原文链接：<a href="https://blog.gospodarets.com/css_properties_in_depth">CSS custom properties (native variables) In-Depth</a></p>

  <p>原文发布时间：March 29, 2016</p>

  <p>原作者：Serg Gospodarets</p>

  <p>翻译者：IwYvI</p>

  <p>翻译时间：2016/4/22</p>

  <p>第一次翻译英语文章，如有不准确的地方希望向我提出来</p>
</blockquote>


</div>


	    </div>
  	</div>
</div>


	<div class="largeCard comments">
	<div id="disqus_thread" class="largeCardContent commentsContent">
		<script>
	/**
	* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
	* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
	*/
	/*
	var disqus_config = function () {
	this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
	this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
	};
	*/
	(function() { // DON'T EDIT BELOW THIS LINE
	var d = document, s = d.createElement('script');

	s.src = '//iwyvi.disqus.com/embed.js';

	s.setAttribute('data-timestamp', +new Date());
	(d.head || d.body).appendChild(s);
	})();
		</script>
		<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	</div>
</div>



    </div>

      </div>
  <div class="footer">
    <div class="link">
      
        <a href="https://github.com/IwYvI"><img src="http://7xsaq2.com1.z0.glb.clouddn.com/img%2Fgithub.png" height="32" width="32" alt=""></a>
      
    </div>
    <div class="copyright">
      <p>Copyright © 2016, Content By <a href="https://github.com/IwYvI">IwYvI</a>. All Rights Reserved.
      </p>
      <p>Theme By <a href="https://github.com/IwYvI">IwYvI</a></p>
    </div>
  </div>
</div>

	<span style="display: none;">
  <script src="http://s4.cnzz.com/z_stat.php?id=1259030304&web_id=1259030304" language="JavaScript"></script>
</span>

  </body>

</html>
